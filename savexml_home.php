<?php
// 			$str = '{"banner":
// [
// {
// "description":"【名山藝術】觀山‧望水-藝術家山水聯展(特別導覽預約)",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/Banner_01.jpg",
// "url":"/event/register/1409241136071389810407",
// "person":"May"},
// {
// "description":"【名山藝術】觀山‧望水-藝術家山水聯展(特別導覽預約)",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/Banner_01.jpg",
// "url":"/event/register/1409241136071389810407",
// "person":"May"},
// {
// "description":"【名山藝術】觀山‧望水-藝術家山水聯展(特別導覽預約)",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/Banner_01.jpg",
// "url":"/event/register/1409241136071389810407",
// "person":"May"},
// {
// "description":"【名山藝術】觀山‧望水-藝術家山水聯展(特別導覽預約)",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/Banner_01.jpg",
// "url":"/event/register/1409241136071389810407",
// "person":"May"},
// {
// "description":"【名山藝術】觀山‧望水-藝術家山水聯展(特別導覽預約)",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/Banner_01.jpg",
// "url":"/event/register/1409241136071389810407",
// "person":"May"}
// ],
// "editorChoice":[
// {"key":"game",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/game_home.jpg",
// "zh-tw":"遊戲",
// "en-us":"Games"},

// {"key":"game",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/game_home.jpg",
// "zh-tw":"遊戲",
// "en-us":"Games"},

// {"key":"game",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/game_home.jpg",
// "zh-tw":"遊戲",
// "en-us":"Games"},

// {"key":"game",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/game_home.jpg",
// "zh-tw":"遊戲",
// "en-us":"Games"}
// ],

// "fresh":[{
// "description":"粉紅10月一起瑜珈 支持奮鬥中的乳癌姊妹",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/fun_01.jpg",
// "url":"http://blog.accupass.com/pink-oct.html"},
// {
// "description":"粉紅10月一起瑜珈 支持奮鬥中的乳癌姊妹",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/fun_01.jpg",
// "url":"http://blog.accupass.com/pink-oct.html"},
// {
// "description":"粉紅10月一起瑜珈 支持奮鬥中的乳癌姊妹",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/fun_01.jpg",
// "url":"http://blog.accupass.com/pink-oct.html"}
// ],
// "place":[
// {
// "title":"松江拾壹 Junction",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/space_01.jpg",
// "url":"http://blog.accupass.com/space-junction.html",
// "description":"人文與藝術匯集的音樂殿堂",
// "place":"臺北"
// },
// {
// "title":"松江拾壹 Junction",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/space_01.jpg",
// "url":"http://blog.accupass.com/space-junction.html",
// "description":"人文與藝術匯集的音樂殿堂",
// "place":"臺北"
// },
// {
// "title":"松江拾壹 Junction",
// "imageUrl":"http://accupassv3storage.blob.core.windows.net/images/space_01.jpg",
// "url":"http://blog.accupass.com/space-junction.html",
// "description":"人文與藝術匯集的音樂殿堂",
// "place":"臺北"
// }
// ],
// "organizer":[
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// },
// {
// "description":"MiniCook迷你酷",
// "imageUrl":"/images/index/logo_mini_cook.png",
// "url":"http://www.accupass.com/org/detail/r/1408110503182085074980/1/0"
// }
// ]
// }
// ';
// $str = str_replace("\n", "", $str);
// echo $str;
// return;



	// $_POST = json_decode($str, true);
	//print_r($_POST);

	class SimpleXMLExtended extends SimpleXMLElement {
	  public function addCData($cdata_text) {
	    $node = dom_import_simplexml($this); 
	    $no   = $node->ownerDocument; 
	    $node->appendChild($no->createCDATASection($cdata_text)); 
	  } 
	}


	$xml = new SimpleXMLExtended('<?xml version="1.0" encoding="utf-8" ?><home/>');

	$organizer_count = 0;

	foreach ($_POST as $class_name => $item) {
		$class_name_xml = $xml->addChild($class_name);
		$item_xml;
		foreach ($item as $key => $content) {
			if($class_name != 'organizer' || $organizer_count % 6 == 0)
				$item_xml = $class_name_xml->addChild('item');
			
			$child_item = $item_xml;

			if($class_name == 'place'){
				if($key === 0){
					$item_xml->addattribute('key','big');
				}else{
					$item_xml->addattribute('key','normal');
				}
				
			}elseif ($class_name == 'organizer') {
				$child_item = $item_xml->addChild('childItem');
				$organizer_count++;
			}

			foreach ($content as $content_name => $value) {
				if ($class_name == 'editorChoice' && $content_name =='zh-tw'){
					$child_item = $child_item->addChild('title');
				}

				if ($content_name == 'description' || $content_name == 'title'){
					// $value = '<![CDATA['.$value.']]>';
					$child_item->addCData($content_name,$value);
				}else{
					$child_item->addChild($content_name,$value);
				}
				
			}
		}
	}
	$file_name = time().'.xml';
	$dom = new DOMDocument('1.0');
	$dom->preserveWhiteSpace = false;
	$dom->formatOutput = true;
	$dom->loadXML($xml->asXML());
	// echo $dom->saveXML();
	$xml_str =  $dom->saveXML();
	$file = fopen($file_name, 'w');
	fwrite($file, $xml_str);
	fclose($file);
	echo $file_name;
?>